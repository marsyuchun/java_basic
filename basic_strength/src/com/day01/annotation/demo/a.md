## 需求梳理
1、目标是实现星标店铺和普通店铺之间的互相转化  
2、店铺转化的方式有两种：规划标记的扭转和上会过程扭转  
3、普通转星标的操作过程和状态校验：   
- 普通店铺项目状态不为【二次复盘流程】流程中  
- 普通店铺状态不处于【已过会】、【可签约】、【已签约】状态  
- 普通店铺未上报转星标店铺后为未上报  
- 普通店铺已上报，转星标店铺后根据是否有进行中项目判定；有进行中项目为【已上报】、项目已停止位【已分配】、项目已签约为【已签约】

4、星标转普通的操作过程和状态校验：   
- 星标店铺处于【待分配大区经理】【待分配开发】【已分配】状态时可修改  
- 星标店铺处于【已上报】且项目并未处于【二次复盘流程】流程中，且项目不处于【已过会】【可签约】【已签约】状态。  
- 店铺存在进行中【星标店铺巡视确认】流程，则拦截并告知：当前存在进行中【星标店铺巡视确认】流程，处理人【】，请在流程完成后重试。  
- 店铺存在进行中【星标店铺审批v2】流程，则拦截并告知：当前存在进行中【星标店铺审批v2】流程，处理人【】，请在流程完成后重试。

5、店铺扭转时保留以下信息：  
- KP信息、拜访信息保留  
- 店铺基础信息保留
- 采集部基础信息、规划部质量信息，触发流程处理  

## 主要测试点
1、星标店铺手动操作转普通店铺
- 营建后台-信息采集-重点商圈-地图页展示【扭转为普通店铺】按钮
- 当星标店铺状态处于【待分配大区经理】【待分配开发】【已分配】状态扭转为普通店铺，可以扭转  
- 当店铺状态处于【已上报】，项目状态不在【二次复盘流程中】且不处于【已过会】【可签约】【已签约】状态，可以扭转
- 星标店铺转为普通店铺时，采集部基础信息、规划部质量信息、换手信息、店铺基础信息、KP信息和拜访信息保留  
- 若店铺存在进行中【星标店铺巡视确认】流程，则拦截并告知：当前存在进行中【星标店铺巡视确认】流程，处理人【】，请在流程完成后重试  
- 若店铺存在进行中【星标店铺审批v2】流程，则拦截并告知：当前存在进行中【星标店铺审批v2】流程，处理人【】，请在流程完成后重试  
- 其余节点不可发起星标店铺转普通店铺  
2、星标店铺自动转普通店铺

## 需求澄清点
1、补全数据流程中，跳过状态校验  
2、二次复盘流程中不能扭转





## 测试数据
- 涉及流程：  
1、普通转星标数据补全流程  023701  
2、店铺类型变更通知流程  023705  
3、日商hurdle上会流程   019579  
- 测试


## 上线步骤  
1、开发提交sql
```sql
ALTER TABLE `opc_flag`.`key_shop_info`
ADD COLUMN `is_key_shop` tinyint(4) NOT NULL DEFAULT 1 COMMENT '是否是星标店铺 1 是 0 否' AFTER `last_turn_over_record`;
```
2、Wconfig配置  workflow.json	
```
"410": "023701",
"411": "023705"
```


4、后端发布，前端发布
流程中回调接口已发布
3、新增和修改的工作流
- 普通转星标数据补全流程  023701  
- 店铺类型变更通知流程  023705  
- 日商hurdle上会流程   019579  


5、表单中心发布
w_zeus_form_center应用下 keyShopDetailGrade页面  
+1

6、rbac配置 已完成

## 回滚步骤
1、撤回流程  （日商hurdle上会流程   019579）  
2、表单中心回滚
3、回滚代码  
4、rbac权限删除  
5、



## 新增流程接口
https://ripple.blibee.com/ripple/web/WorkFlow/InterfaceCenter
接口编码 101771 101767 101768

## 线上问题
1、星标店铺上报中，提交后页面未刷新，后端校验  
2、普通店铺调度不支持uid检索，只支持中文姓名  
3、/api/web/businessInfo/showMainPage/v1 接口超时时间  